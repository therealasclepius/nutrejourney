<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nutre M&A Target Finder</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #0a0a0a; color: #fff; }
        
        .header {
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            padding: 25px 30px;
        }
        .header h1 { font-size: 28px; font-weight: 700; margin-bottom: 8px; }
        .header .subtitle { font-size: 15px; opacity: 0.9; }
        
        .controls-bar {
            background: #1a1a1a;
            padding: 20px 30px;
            border-bottom: 1px solid #333;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .filter-label {
            font-size: 12px;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        select, input[type="range"] {
            background: #252525;
            color: #fff;
            border: 1px solid #444;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
        }
        
        select { cursor: pointer; }
        select:hover { border-color: #7c3aed; }
        
        .range-value {
            font-size: 13px;
            font-weight: 600;
            color: #7c3aed;
            min-width: 60px;
        }
        
        .container { display: flex; height: calc(100vh - 160px); }
        #map { flex: 1; height: 100%; }
        
        .sidebar {
            width: 400px;
            background: #1a1a1a;
            padding: 0;
            overflow-y: auto;
            border-left: 1px solid #333;
        }
        
        .sidebar-header {
            background: #252525;
            padding: 20px;
            border-bottom: 2px solid #7c3aed;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .sidebar-header h3 {
            font-size: 16px;
            color: #7c3aed;
            margin-bottom: 8px;
        }
        
        .sidebar-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            font-size: 12px;
        }
        
        .stat-mini {
            color: #9ca3af;
        }
        
        .stat-mini strong {
            color: #fff;
            display: block;
            font-size: 16px;
            margin-top: 2px;
        }
        
        .target-list {
            padding: 20px;
        }
        
        .target-card {
            background: #252525;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 4px solid;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .target-card:hover {
            background: #2d2d2d;
            transform: translateX(5px);
        }
        
        .tier-a { border-color: #10b981; }
        .tier-b { border-color: #3b82f6; }
        .tier-c { border-color: #f59e0b; }
        
        .target-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }
        
        .target-name {
            font-size: 15px;
            font-weight: 700;
            color: #fff;
        }
        
        .target-location {
            font-size: 11px;
            color: #9ca3af;
            margin-top: 2px;
        }
        
        .score-badge {
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            color: #fff;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
        }
        
        .target-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .metric-small {
            background: #1a1a1a;
            padding: 6px;
            border-radius: 4px;
            text-align: center;
        }
        
        .metric-small-label {
            font-size: 10px;
            color: #9ca3af;
            text-transform: uppercase;
        }
        
        .metric-small-value {
            font-size: 13px;
            font-weight: 700;
            color: #fff;
            margin-top: 2px;
        }
        
        .target-tags {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        
        .tag {
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 10px;
            font-weight: 600;
        }
        
        .tag-defensive { background: #7f1d1d; color: #fecaca; }
        .tag-offensive { background: #065f46; color: #a7f3d0; }
        .tag-premium { background: #581c87; color: #e9d5ff; }
        .tag-volume { background: #1e3a8a; color: #bfdbfe; }
        
        /* Popup Styles */
        .leaflet-popup-content-wrapper { background: #1a1a1a; color: #fff; border-radius: 12px; }
        .leaflet-popup-content { margin: 20px; font-size: 13px; min-width: 320px; }
        .leaflet-popup-tip { background: #1a1a1a; }
        
        .popup-company {
            font-size: 20px;
            font-weight: 700;
            color: #7c3aed;
            margin-bottom: 4px;
        }
        
        .popup-tagline {
            font-size: 12px;
            color: #9ca3af;
            margin-bottom: 16px;
        }
        
        .deal-metrics {
            background: #252525;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .deal-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #333;
        }
        
        .deal-row:last-child { border-bottom: none; }
        
        .deal-label { color: #9ca3af; font-size: 12px; }
        .deal-value { font-weight: 700; color: #fff; font-size: 13px; }
        
        .strategic-fit {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #333;
        }
        
        .fit-title {
            font-size: 12px;
            color: #7c3aed;
            text-transform: uppercase;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .fit-reasons {
            font-size: 12px;
            line-height: 1.8;
            color: #d1d5db;
        }
        
        .fit-reasons li {
            margin-bottom: 6px;
        }
        
        .action-btn {
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            color: #fff;
            padding: 10px 16px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            width: 100%;
            margin-top: 12px;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            background: linear-gradient(135deg, #6d28d9 0%, #4c1d95 100%);
            transform: translateY(-2px);
        }
        
        /* Pipeline Tracker Modal */
        .pipeline-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            overflow-y: auto;
        }
        
        .pipeline-modal.active {
            display: block;
        }
        
        .pipeline-container {
            max-width: 1400px;
            margin: 40px auto;
            padding: 20px;
        }
        
        .pipeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: #1a1a1a;
            padding: 20px;
            border-radius: 12px;
        }
        
        .pipeline-title {
            font-size: 24px;
            font-weight: 700;
            color: #7c3aed;
        }
        
        .pipeline-stats {
            display: flex;
            gap: 20px;
            font-size: 13px;
        }
        
        .stat-item {
            color: #9ca3af;
        }
        
        .stat-item strong {
            color: #fff;
            display: block;
            font-size: 18px;
        }
        
        .close-pipeline {
            background: #252525;
            color: #fff;
            border: 1px solid #444;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }
        
        .close-pipeline:hover {
            border-color: #7c3aed;
        }
        
        .pipeline-board {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .stage-column {
            background: #1a1a1a;
            border-radius: 12px;
            padding: 15px;
            min-height: 400px;
        }
        
        .stage-header {
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .stage-count {
            background: #252525;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
        }
        
        .stage-outreach .stage-header { color: #6b7280; border-color: #374151; }
        .stage-conversation .stage-header { color: #3b82f6; border-color: #1e40af; }
        .stage-loi .stage-header { color: #f59e0b; border-color: #d97706; }
        .stage-diligence .stage-header { color: #8b5cf6; border-color: #6d28d9; }
        .stage-closed .stage-header { color: #10b981; border-color: #047857; }
        
        .deal-card {
            background: #252525;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid;
        }
        
        .deal-card:hover {
            background: #2d2d2d;
            transform: translateX(3px);
        }
        
        .deal-card.tier-a { border-color: #10b981; }
        .deal-card.tier-b { border-color: #3b82f6; }
        .deal-card.tier-c { border-color: #f59e0b; }
        
        .deal-card-header {
            font-size: 14px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 6px;
        }
        
        .deal-card-meta {
            font-size: 11px;
            color: #9ca3af;
            margin-bottom: 8px;
        }
        
        .deal-card-tags {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
            margin-bottom: 8px;
        }
        
        .deal-tag {
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 8px;
            background: #1a1a1a;
            color: #d1d5db;
        }
        
        .deal-card-notes {
            font-size: 11px;
            color: #d1d5db;
            font-style: italic;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #333;
        }
        
        .deal-actions {
            display: flex;
            gap: 4px;
            margin-top: 8px;
        }
        
        .deal-action-btn {
            font-size: 10px;
            padding: 4px 8px;
            border-radius: 4px;
            background: #1a1a1a;
            border: 1px solid #444;
            color: #9ca3af;
            cursor: pointer;
        }
        
        .deal-action-btn:hover {
            border-color: #7c3aed;
            color: #fff;
        }
        
        /* Deal Detail Modal */
        .deal-detail-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1a1a1a;
            border-radius: 12px;
            padding: 25px;
            max-width: 500px;
            width: 90%;
            z-index: 10001;
            border: 1px solid #333;
        }
        
        .deal-detail-modal.active {
            display: block;
        }
        
        .deal-detail-header {
            font-size: 18px;
            font-weight: 700;
            color: #7c3aed;
            margin-bottom: 15px;
        }
        
        .deal-detail-field {
            margin-bottom: 15px;
        }
        
        .deal-detail-label {
            font-size: 11px;
            color: #9ca3af;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        
        .deal-detail-input {
            width: 100%;
            background: #252525;
            border: 1px solid #444;
            color: #fff;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
        }
        
        .deal-detail-textarea {
            width: 100%;
            background: #252525;
            border: 1px solid #444;
            color: #fff;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            min-height: 80px;
            font-family: inherit;
        }
        
        .deal-detail-select {
            width: 100%;
            background: #252525;
            border: 1px solid #444;
            color: #fff;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
        }
        
        .deal-detail-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .save-deal-btn {
            flex: 1;
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            color: #fff;
            padding: 10px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }
        
        .cancel-deal-btn {
            flex: 1;
            background: #252525;
            color: #fff;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #444;
            cursor: pointer;
        }
        
        .remove-deal-btn {
            background: #7f1d1d;
            color: #fecaca;
            padding: 10px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 12px;
        }
        
        .view-pipeline-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            color: #fff;
            padding: 15px 25px;
            border-radius: 30px;
            border: none;
            cursor: pointer;
            font-weight: 700;
            font-size: 14px;
            box-shadow: 0 4px 20px rgba(124, 58, 237, 0.4);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .view-pipeline-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(124, 58, 237, 0.6);
        }
        
        .pipeline-badge {
            background: #fff;
            color: #7c3aed;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 700;
        }
        
        .legend-box {
            background: #252525;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .legend-title {
            font-size: 12px;
            color: #7c3aed;
            text-transform: uppercase;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 12px;
        }
        
        .legend-marker {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 10px;
        }
        
        @media (max-width: 1024px) {
            .container { flex-direction: column; }
            .sidebar { width: 100%; height: 400px; border-left: none; border-top: 1px solid #333; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéØ M&A Target Finder</h1>
        <div class="subtitle">Strategic Acquisition Pipeline: 15 Research-Backed Targets ‚Ä¢ $5-10M Investment ‚Ä¢ 18-24 Months</div>
    </div>
    
    <div class="controls-bar">
        <div class="filter-group">
            <span class="filter-label">Strategy</span>
            <select id="strategyFilter">
                <option value="all">All Targets</option>
                <option value="defensive">Defensive Only</option>
                <option value="offensive">Offensive Only</option>
            </select>
        </div>
        
        <div class="filter-group">
            <span class="filter-label">Revenue Range</span>
            <select id="revenueFilter">
                <option value="all">All Ranges</option>
                <option value="sweet">$500K-$3M (Sweet Spot)</option>
                <option value="small">$300K-$500K</option>
                <option value="large">$3M+</option>
            </select>
        </div>
        
        <div class="filter-group">
            <span class="filter-label">Min Score</span>
            <input type="range" id="scoreFilter" min="60" max="95" value="70" step="5">
            <span class="range-value" id="scoreValue">70</span>
        </div>
        
        <div class="filter-group">
            <span class="filter-label">Market</span>
            <select id="marketFilter">
                <option value="all">All Markets</option>
                <option value="dmv">DMV (MD/DC/VA)</option>
                <option value="florida">Florida</option>
                <option value="georgia">Georgia/Atlanta</option>
                <option value="northeast">Northeast</option>
            </select>
        </div>
    </div>
    
    <div class="container">
        <div id="map"></div>
        
        <div class="sidebar">
            <div class="sidebar-header">
                <h3>Acquisition Pipeline</h3>
                <div class="sidebar-stats">
                    <div class="stat-mini">Total Targets<strong id="totalTargets">15</strong></div>
                    <div class="stat-mini">Avg Score<strong id="avgScore">81</strong></div>
                    <div class="stat-mini">Total Valuation<strong id="totalVal">$47.9M</strong></div>
                    <div class="stat-mini">Priority Deals<strong id="priorityDeals">5</strong></div>
                </div>
            </div>
            
            <div class="target-list" id="targetList">
                <!-- Targets populated by JS -->
            </div>
        </div>
    </div>

    <!-- Pipeline Tracker Modal -->
    <div class="pipeline-modal" id="pipelineModal">
        <div class="pipeline-container">
            <div class="pipeline-header">
                <div>
                    <div class="pipeline-title">üéØ M&A Deal Pipeline</div>
                    <div style="font-size: 13px; color: #9ca3af; margin-top: 5px;">Track acquisition progress across all stages</div>
                </div>
                <div class="pipeline-stats">
                    <div class="stat-item">Active Deals<strong id="activeDealsCount">0</strong></div>
                    <div class="stat-item">Total Value<strong id="totalPipelineValue">$0M</strong></div>
                </div>
                <button class="close-pipeline" onclick="closePipeline()">‚úï Close</button>
            </div>
            
            <div class="pipeline-board">
                <div class="stage-column stage-outreach">
                    <div class="stage-header">
                        üìß Initial Outreach
                        <span class="stage-count" id="count-outreach">0</span>
                    </div>
                    <div id="stage-outreach" class="stage-deals"></div>
                </div>
                
                <div class="stage-column stage-conversation">
                    <div class="stage-header">
                        ü§ù In Conversation
                        <span class="stage-count" id="count-conversation">0</span>
                    </div>
                    <div id="stage-conversation" class="stage-deals"></div>
                </div>
                
                <div class="stage-column stage-loi">
                    <div class="stage-header">
                        üìÑ LOI Submitted
                        <span class="stage-count" id="count-loi">0</span>
                    </div>
                    <div id="stage-loi" class="stage-deals"></div>
                </div>
                
                <div class="stage-column stage-diligence">
                    <div class="stage-header">
                        üîç Due Diligence
                        <span class="stage-count" id="count-diligence">0</span>
                    </div>
                    <div id="stage-diligence" class="stage-deals"></div>
                </div>
                
                <div class="stage-column stage-closed">
                    <div class="stage-header">
                        ‚úÖ Closed
                        <span class="stage-count" id="count-closed">0</span>
                    </div>
                    <div id="stage-closed" class="stage-deals"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Deal Detail Modal -->
    <div class="deal-detail-modal" id="dealDetailModal">
        <div class="deal-detail-header" id="dealDetailName">Deal Details</div>
        <div class="deal-detail-field">
            <div class="deal-detail-label">Deal Stage</div>
            <select class="deal-detail-select" id="dealStage">
                <option value="outreach">üìß Initial Outreach</option>
                <option value="conversation">ü§ù In Conversation</option>
                <option value="loi">üìÑ LOI Submitted</option>
                <option value="diligence">üîç Due Diligence</option>
                <option value="closed">‚úÖ Closed</option>
            </select>
        </div>
        <div class="deal-detail-field">
            <div class="deal-detail-label">Last Contact Date</div>
            <input type="date" class="deal-detail-input" id="dealContactDate">
        </div>
        <div class="deal-detail-field">
            <div class="deal-detail-label">Next Follow-Up Date</div>
            <input type="date" class="deal-detail-input" id="dealFollowUpDate">
        </div>
        <div class="deal-detail-field">
            <div class="deal-detail-label">Notes</div>
            <textarea class="deal-detail-textarea" id="dealNotes" placeholder="Key conversation points, next steps, concerns..."></textarea>
        </div>
        <div class="deal-detail-actions">
            <button class="save-deal-btn" onclick="saveDealDetails()">Save Changes</button>
            <button class="cancel-deal-btn" onclick="closeDealDetail()">Cancel</button>
        </div>
        <button class="remove-deal-btn" onclick="removeDeal()" style="width: 100%; margin-top: 10px;">Remove from Pipeline</button>
    </div>
    
    <!-- Floating Pipeline Button -->
    <button class="view-pipeline-btn" onclick="openPipeline()">
        View Pipeline
        <span class="pipeline-badge" id="pipelineBadge">0</span>
    </button>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Initialize map
        var map = L.map('map').setView([35.0, -82.0], 6);
        
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap &copy; CARTO',
            maxZoom: 20
        }).addTo(map);

        // M&A Target Database - ACTUAL TARGETS FROM RESEARCH
        var targets = [
            // TIER A: Highest Priority (Score 85+)
            {
                id: 1,
                name: 'Yes Chef!',
                location: 'Baltimore, MD (3 locations)',
                coords: [39.2904, -76.6122],
                revenue: 1650000,
                customers: 575,
                marketShare: 18,
                tier: 'A',
                score: 95,
                strategy: 'defensive',
                valuation: 2640000,
                market: 'dmv',
                positioning: 'Premium',
                strengths: ['3 locations (kitchen, retail, UMB campus)', 'University institutional contract', 'Franchise plans', 'Strong media presence'],
                weaknesses: ['Founder dependency', 'Limited tech stack'],
                dealRationale: 'CRITICAL: Largest Baltimore asset, 3 locations, institutional contracts, blocks F&F before Jan 3 launch',
                contact: {
                    website: 'https://yeschef.me/',
                    phone: '877-937-2433',
                    instagram: 'https://www.instagram.com/yeschefhq/',
                    facebook: 'https://www.facebook.com/YesChefHQ/',
                    twitter: 'https://x.com/yeschefhq',
                    linkedin: 'https://www.linkedin.com/company/yeschef',
                    founders: 'Clint Roze (Executive Chef) & Jodi Roze (Marketing Director)'
                }
            },
            {
                id: 2,
                name: 'Mind Over Matter Meal Prep',
                location: 'Lutz/Tampa Bay, FL',
                coords: [28.1536, -82.4610],
                revenue: 2250000,
                customers: 1000,
                marketShare: 10,
                tier: 'A',
                score: 92,
                strategy: 'offensive',
                valuation: 3375000,
                market: 'florida',
                positioning: 'Premium',
                strengths: ['66x growth (30‚Üí2,000 meals/week)', '12+ gym pickup locations', '500+ recipes', 'Fitness community aligned'],
                weaknesses: ['Founder-operated', 'Gym dependency'],
                dealRationale: 'OFFENSIVE: Perfect Tampa acquisition, 66x growth, gym network aligns with Nutre fitness focus',
                contact: {
                    website: 'https://www.mindovermattermeals.com/',
                    instagram: 'https://www.instagram.com/mindovermattermealprep/',
                    facebook: 'https://www.facebook.com/mindovermattermealprep/',
                    linkedin: 'https://www.linkedin.com/company/mindovermattermealprep',
                    founders: 'Sam Kennedy (Former Coastal Carolina football player)'
                }
            },
            {
                id: 3,
                name: 'FitEx Meals',
                location: 'Tampa & St. Petersburg, FL',
                coords: [27.9506, -82.4572],
                revenue: 3500000,
                customers: 1100,
                marketShare: 12,
                tier: 'A',
                score: 90,
                strategy: 'offensive',
                valuation: 6300000,
                market: 'florida',
                positioning: 'Premium',
                strengths: ['2 storefront locations (Tampa + St. Pete 2024)', 'Premium pricing $9.59-10.99/meal', 'Statewide FL shipping', 'Strong media features'],
                weaknesses: ['Higher overhead with retail', 'Recent expansion risk'],
                dealRationale: 'OFFENSIVE: Immediate Tampa Bay market dominance with 2 locations and proven expansion',
                contact: {
                    website: 'https://www.fitexmeals.com/',
                    instagram: 'https://www.instagram.com/fitexmeals/',
                    facebook: 'https://www.facebook.com/FitExMEals/',
                    twitter: 'https://x.com/FitexMeals',
                    tiktok: 'https://www.tiktok.com/@fitexmeals',
                    founders: 'Michael Murphy (Director of Operations)'
                }
            },
            {
                id: 4,
                name: 'Eating By V',
                location: 'Miami-Dade County, FL',
                coords: [25.7617, -80.1918],
                revenue: 2100000, // Mid-range of $1.2-3M estimate
                customers: 900, // Estimated from 250+ families monthly
                marketShare: 9,
                tier: 'A',
                score: 88,
                strategy: 'offensive',
                valuation: 3360000, // 1.6x revenue
                market: 'florida',
                positioning: 'Premium',
                strengths: ['"Miami\'s #1 Meal Prep Delivery"', 'All-women team', 'Bootstrap success ($100K/month year 1)', '400+ Google reviews'],
                weaknesses: ['Geographic concentration', 'Limited B2B'],
                dealRationale: 'OFFENSIVE: Ideal South Florida target, strong brand, clean acquisition with no VC backing',
                contact: {
                    website: 'https://www.eatingbyv.com/',
                    instagram: 'https://www.instagram.com/eatingbyv/',
                    facebook: 'https://www.facebook.com/globalxempire/',
                    twitter: 'https://x.com/vvespinosa',
                    linkedin: 'https://www.linkedin.com/in/viviespinosa/',
                    tiktok: 'https://www.tiktok.com/@eatingbyv',
                    founders: 'Viviana Espinosa (FIU, 10+ years food industry)'
                }
            },
            {
                id: 5,
                name: 'Munch Thyme',
                location: 'Homestead, FL',
                coords: [25.4687, -80.4776],
                revenue: 3000000, // Verified $3M revenue
                customers: 1100,
                marketShare: 8,
                tier: 'A',
                score: 87,
                strategy: 'offensive',
                valuation: 6000000, // 2.0x for owned organic farm
                market: 'florida',
                positioning: 'Premium',
                strengths: ['Certified OWNED organic farm', 'Miami\'s FIRST farm-to-table delivery', '9 years operation', 'Multi-year retention'],
                weaknesses: ['Very low activity signals', 'Farm dependency'],
                dealRationale: 'OFFENSIVE: Unique farm-to-table asset, owned organic farm is significant differentiator and defensible moat',
                contact: {
                    website: 'https://munchthyme.com/',
                    instagram: 'https://www.instagram.com/munch_thyme/',
                    facebook: 'https://www.facebook.com/munchthymemeals/',
                    twitter: 'https://x.com/MunchThyme',
                    founders: 'David Lesser (Former NYC high-end restaurants)'
                }
            },
            
            // TIER B: Strong Targets (Score 75-84)
            {
                id: 6,
                name: 'Perfectly Portioned Nutrition',
                location: 'Sandy Springs/Atlanta, GA',
                coords: [33.9304, -84.3733],
                revenue: 1000000,
                customers: 475,
                marketShare: 11,
                tier: 'B',
                score: 84,
                strategy: 'offensive',
                valuation: 1600000,
                market: 'georgia',
                positioning: 'Premium',
                strengths: ['Dietitian-led (RDN)', 'Georgia State University professor credibility', 'Student intern labor pipeline', 'Premium membership model'],
                weaknesses: ['Shared kitchen', 'Limited scale'],
                dealRationale: 'OFFENSIVE: Dietitian credibility differentiates from fitness-only competitors in Atlanta',
                contact: {
                    website: 'https://perfectlyportionednutrition.com/',
                    instagram: 'https://www.instagram.com/mealprepatl/',
                    facebook: 'https://www.facebook.com/perfectlyportionednutrition/',
                    tiktok: 'https://www.tiktok.com/@mealprepatl',
                    founders: 'Jessica Todd, RDN (Georgia State University professor)'
                }
            },
            {
                id: 7,
                name: 'Mindful Meals',
                location: 'Orlando, FL',
                coords: [28.5383, -81.3792],
                revenue: 1750000, // Mid-range of $1-$2.5M estimate
                customers: 675,
                marketShare: 10,
                tier: 'B',
                score: 83,
                strategy: 'offensive',
                valuation: 2800000, // 1.6x revenue
                market: 'florida',
                positioning: 'Premium',
                strengths: ['"Orlando\'s Best Meal Prep 2024"', 'UCF connections', '4 meal plans with GF options', 'Recent award validates quality'],
                weaknesses: ['Moderate social following', 'Limited geographic reach'],
                dealRationale: 'OFFENSIVE: Clear Orlando winner with 2024 award, premium positioning over discount competitors',
                contact: {
                    website: 'https://www.mindfulmealdelivery.com/',
                    instagram: 'https://www.instagram.com/mindfulmealdelivery/',
                    facebook: 'https://www.facebook.com/mindfulmealdelivery/',
                    founders: 'Blake Meyer (University of Central Florida)'
                }
            },
            {
                id: 8,
                name: 'Farm to Temple',
                location: 'Baltimore/Towson, MD',
                coords: [39.4015, -76.6018],
                revenue: 550000, // Mid-range of $300K-$800K estimate
                customers: 275,
                marketShare: 8,
                tier: 'B',
                score: 82,
                strategy: 'defensive',
                valuation: 770000, // 1.4x revenue
                market: 'dmv',
                positioning: 'Premium',
                strengths: ['Organic farm partnerships', 'COVID-pivot success (2021 relaunch)', 'Nutrition credentials (Master\'s)', 'Expanding service area'],
                weaknesses: ['Small revenue base', 'Shared kitchen'],
                dealRationale: 'DEFENSIVE: Organic premium positioning directly overlaps F&F target customers, critical defensive play',
                contact: {
                    website: 'https://www.farmtotemple.com/',
                    email: 'hello@farmtotemple.com',
                    instagram: 'https://www.instagram.com/farmtotemple/',
                    facebook: 'https://www.facebook.com/farmtotemple/',
                    twitter: 'https://x.com/Farmtotemple',
                    founders: 'Raven Temple (Master\'s in Alternative Medicine & Nutrition)'
                }
            },
            {
                id: 9,
                name: 'Jet Fuel Meals',
                location: 'South Florida (expanding statewide)',
                coords: [26.1224, -80.1373],
                revenue: 3500000, // Mid-range of $2-5M estimate
                customers: 1400,
                marketShare: 7,
                tier: 'B',
                score: 79,
                strategy: 'offensive',
                valuation: 5600000, // 1.6x revenue
                market: 'florida',
                positioning: 'Volume',
                strengths: ['"Florida\'s #1 Rated"', '51K Instagram followers', 'Expanding to Tampa & Orlando', '3x weekly delivery'],
                weaknesses: ['Multi-market complexity', 'Expansion costs'],
                dealRationale: 'OFFENSIVE: Multi-market FL presence creates immediate geographic synergies across state',
                contact: {
                    website: 'https://jetfuelmeals.com/',
                    instagram: 'https://www.instagram.com/jetfuelmeals/',
                    facebook: 'https://www.facebook.com/JetFuelMeals/',
                    linkedin: 'https://www.linkedin.com/company/jet-fuel-meals',
                    tiktok: 'https://www.tiktok.com/@jetfuelmeals',
                    founders: 'Robert del Castillo & Vojkan Dimitrijevic'
                }
            },
            {
                id: 10,
                name: 'Scratch Made',
                location: 'Baltimore (Govans), MD',
                coords: [39.3362, -76.5969],
                revenue: 650000,
                customers: 325,
                marketShare: 9,
                tier: 'B',
                score: 78,
                strategy: 'defensive',
                valuation: 910000,
                market: 'dmv',
                positioning: 'Premium',
                strengths: ['Restaurant-quality meals', 'Direct farm sourcing (4 farms)', 'Ghost kitchen efficiency', '3x growth (100‚Üí300 meals/week)'],
                weaknesses: ['Limited DC coverage', 'Founder dependency'],
                dealRationale: 'DEFENSIVE: Ultra-premium farm relationships match F&F farm-to-table credibility',
                contact: {
                    website: 'https://orderscratchmade.com/',
                    instagram: 'https://www.instagram.com/orderscratchmade/',
                    facebook: 'https://www.facebook.com/orderscratchmade/',
                    tiktok: 'https://www.tiktok.com/@orderscratchmade',
                    linkedin: 'https://www.linkedin.com/in/collin-morstein/',
                    founders: 'Collin Morstein (Towson University, former Parts & Labor)'
                }
            },
            
            // TIER C: Opportunistic Targets (Score 70-74)
            {
                id: 11,
                name: 'Atlanta Meal Prep, LLC',
                location: 'Buckhead/Atlanta, GA',
                coords: [33.8434, -84.3671],
                revenue: 2000000,
                customers: 780,
                marketShare: 10,
                tier: 'C',
                score: 74,
                strategy: 'offensive',
                valuation: 3200000,
                market: 'georgia',
                positioning: 'Premium',
                strengths: ['MLB/NFL athlete clientele', '12K Instagram (strongest ATL social)', '$12/meal premium pricing', '8 years operation'],
                weaknesses: ['Older than preferred (2015)', 'High-end niche'],
                dealRationale: 'OFFENSIVE: Established premium brand could command immediate market leadership in Atlanta',
                contact: {
                    website: 'https://atlantamealprep.com/',
                    instagram: 'https://www.instagram.com/atlantamealprep/',
                    facebook: 'https://www.facebook.com/atlmealprep/',
                    linkedin: 'https://www.linkedin.com/in/bealewis/',
                    founders: 'Bea Lewis (Also founded Hush Dinner Club)'
                }
            },
            {
                id: 12,
                name: 'Girl With A Recipe',
                location: 'Atlanta, GA',
                coords: [33.7490, -84.3880],
                revenue: 550000,
                customers: 275,
                marketShare: 7,
                tier: 'C',
                score: 73,
                strategy: 'offensive',
                valuation: 770000,
                market: 'georgia',
                positioning: 'Premium',
                strengths: ['Rapid COVID-era growth (2022)', '150+ rotating recipes', '7,989 Instagram followers', 'Diversified (meal prep + private chef + catering)'],
                weaknesses: ['Very young company', '1-3 employees'],
                dealRationale: 'OFFENSIVE: COVID-era launch with strong reviews and organic growth trajectory',
                contact: {
                    website: 'https://girlwitharecipe.com/',
                    instagram: 'https://www.instagram.com/girl_with_a_recipe/',
                    facebook: 'https://www.facebook.com/p/Girl-With-A-Recipe-100087886161927/',
                    linkedin: 'https://www.linkedin.com/in/jenny-kahn-b8686a123',
                    tiktok: 'https://www.tiktok.com/@girl_with_a_recipe',
                    founders: 'Jenny Kahn (Self-taught, Mediterranean cuisine specialist)'
                }
            },
            {
                id: 13,
                name: 'Jetpack Nutrition',
                location: 'Jacksonville, FL',
                coords: [30.2756, -81.4495],
                revenue: 1250000,
                customers: 490,
                marketShare: 12,
                tier: 'C',
                score: 72,
                strategy: 'offensive',
                valuation: 1750000,
                market: 'florida',
                positioning: 'Premium',
                strengths: ['IFBB Physique Pro founders', 'Newest entrant (July 2024)', 'GMO-free premium positioning', 'Serious fitness credentials'],
                weaknesses: ['Too new (6 months)', 'Limited track record'],
                dealRationale: 'OFFENSIVE: First-mover Jacksonville advantage, acquire before significant brand establishment',
                contact: {
                    website: 'https://jetpacknutrition.com/',
                    instagram: 'https://www.instagram.com/jetpacknutrition/',
                    facebook: 'https://www.facebook.com/Jetpacknutrition/',
                    tiktok: 'https://www.tiktok.com/@jetpacknutrition',
                    founders: 'Jet Yi Peng (IFBB Physique Pro) & Chino You Peng (Chef, BSN)'
                }
            },
            {
                id: 14,
                name: 'SoulFULL Eats',
                location: 'Jacksonville, FL',
                coords: [30.3322, -81.6557],
                revenue: 1250000,
                customers: 500,
                marketShare: 11,
                tier: 'C',
                score: 71,
                strategy: 'offensive',
                valuation: 1750000,
                market: 'florida',
                positioning: 'Premium',
                strengths: ['Le Cordon Bleu chef', 'MOCA Jacksonville catering partner', 'Woman & Black-owned (ESG)', 'Dual revenue (meal prep + catering)'],
                weaknesses: ['Catering dependency', 'Small market'],
                dealRationale: 'OFFENSIVE: Culinary excellence + community credibility, dual revenue streams diversify risk',
                contact: {
                    website: 'https://www.soulfulleatsjax.com/',
                    instagram: 'https://www.instagram.com/soulfulleatsjax',
                    facebook: 'https://www.facebook.com/soulfulleatsjax',
                    twitter: 'https://twitter.com/SoulfullEats',
                    linkedin: 'https://www.linkedin.com/company/soulfull-eats-jax',
                    tiktok: 'https://www.tiktok.com/@soulfulleatsjax',
                    pinterest: 'https://www.pinterest.com/soulfulleatsjax/',
                    founders: 'Shantrell Mixson (Le Cordon Bleu) & Amy Saltmarsh (CrossFit owner)'
                }
            },
            {
                id: 15,
                name: 'ReBuilt Meals',
                location: 'Tampa Bay, FL',
                coords: [27.9944, -82.5943],
                revenue: 4000000,
                customers: 1600,
                marketShare: 13,
                tier: 'C',
                score: 70,
                strategy: 'offensive',
                valuation: 7200000,
                market: 'florida',
                positioning: 'Volume',
                strengths: ['Tampa Bay Business Journal Fast 50 (2023)', 'Large scale operations', 'Professional operations', 'Strong market recognition'],
                weaknesses: ['Higher valuation', 'May be too mature'],
                dealRationale: 'OFFENSIVE: Scale player in Tampa provides immediate market leadership and operational leverage',
                contact: {
                    website: 'https://www.rebuiltmeals.com/',
                    instagram: 'https://www.instagram.com/rebuiltmeals/',
                    facebook: 'https://www.facebook.com/RebuiltMeals/',
                    twitter: 'https://x.com/ReBuiltMeals',
                    linkedin: 'https://www.linkedin.com/company/rebuilt-meals'
                }
            }
        ];

        var markers = [];
        var filteredTargets = targets;

        function getMarkerColor(tier) {
            return tier === 'A' ? '#10b981' : tier === 'B' ? '#3b82f6' : '#f59e0b';
        }

        function getMarkerSize(score) {
            return score >= 90 ? 14 : score >= 80 ? 12 : 10;
        }

        function formatCurrency(value) {
            if (value >= 1000000) return '$' + (value / 1000000).toFixed(1) + 'M';
            return '$' + (value / 1000).toFixed(0) + 'K';
        }

                function createPopup(target) {
            var html = '<div class="popup-company">' + target.name + '</div>';
            html += '<div class="popup-tagline">' + target.location + ' ‚Ä¢ ' + target.positioning + ' Positioning</div>';
            
            html += '<div class="deal-metrics">';
            html += '<div class="deal-row"><span class="deal-label">Annual Revenue</span><span class="deal-value">' + formatCurrency(target.revenue) + '</span></div>';
            html += '<div class="deal-row"><span class="deal-label">Customer Base</span><span class="deal-value">' + target.customers.toLocaleString() + '</span></div>';
            html += '<div class="deal-row"><span class="deal-label">Market Share</span><span class="deal-value">' + target.marketShare + '%</span></div>';
            html += '<div class="deal-row"><span class="deal-label">Valuation (2x)</span><span class="deal-value">' + formatCurrency(target.valuation) + '</span></div>';
            html += '<div class="deal-row"><span class="deal-label">Strategic Fit</span><span class="deal-value">' + target.score + '/100</span></div>';
            html += '</div>';
            
            // Add contact information if available
            if (target.contact) {
                html += '<div class="strategic-fit">';
                html += '<div class="fit-title">Contact Information</div>';
                html += '<div style="font-size: 11px; line-height: 1.6;">';
                
                if (target.contact.founders) {
                    html += '<div style="margin-bottom: 8px; color: #fff;"><strong>Founders:</strong> ' + target.contact.founders + '</div>';
                }
                
                if (target.contact.website) {
                    html += '<div style="margin-bottom: 4px;">üåê <a href="' + target.contact.website + '" target="_blank" style="color: #7c3aed; text-decoration: none;">Website</a></div>';
                }
                
                if (target.contact.phone) {
                    html += '<div style="margin-bottom: 4px;">üìû ' + target.contact.phone + '</div>';
                }
                
                if (target.contact.email) {
                    html += '<div style="margin-bottom: 4px;">‚úâÔ∏è ' + target.contact.email + '</div>';
                }
                
                var socialLinks = '';
                if (target.contact.instagram) socialLinks += '<a href="' + target.contact.instagram + '" target="_blank" style="color: #7c3aed; margin-right: 8px;">IG</a>';
                if (target.contact.facebook) socialLinks += '<a href="' + target.contact.facebook + '" target="_blank" style="color: #7c3aed; margin-right: 8px;">FB</a>';
                if (target.contact.linkedin) socialLinks += '<a href="' + target.contact.linkedin + '" target="_blank" style="color: #7c3aed; margin-right: 8px;">LI</a>';
                if (target.contact.twitter) socialLinks += '<a href="' + target.contact.twitter + '" target="_blank" style="color: #7c3aed; margin-right: 8px;">X</a>';
                if (target.contact.tiktok) socialLinks += '<a href="' + target.contact.tiktok + '" target="_blank" style="color: #7c3aed;">TT</a>';
                
                if (socialLinks) {
                    html += '<div style="margin-top: 8px;">üì± ' + socialLinks + '</div>';
                }
                
                html += '</div>';
                html += '</div>';
            }
            
            html += '<div class="strategic-fit">';
            html += '<div class="fit-title">Strategic Rationale</div>';
            html += '<div class="fit-reasons">' + target.dealRationale + '</div>';
            html += '</div>';
            
            html += '<button class="action-btn" onclick="addToPipeline(' + target.id + ')">Add to Pipeline ‚Üí</button>';
            
            return html;
        }

        function renderMap() {
            // Clear existing markers
            markers.forEach(m => map.removeLayer(m));
            markers = [];

            filteredTargets.forEach(function(target) {
                var marker = L.circleMarker(target.coords, {
                    radius: getMarkerSize(target.score),
                    fillColor: getMarkerColor(target.tier),
                    color: '#fff',
                    weight: 3,
                    opacity: 1,
                    fillOpacity: 0.8
                }).addTo(map);

                marker.bindPopup(createPopup(target), { maxWidth: 380 });
                markers.push(marker);
            });
        }

        function renderTargetList() {
            var html = '';
            var sorted = filteredTargets.sort((a, b) => b.score - a.score);
            
            sorted.forEach(function(target) {
                html += '<div class="target-card tier-' + target.tier.toLowerCase() + '" onclick="focusTarget(' + target.id + ')">';
                html += '<div class="target-header">';
                html += '<div><div class="target-name">' + target.name + '</div>';
                html += '<div class="target-location">' + target.location + '</div></div>';
                html += '<div class="score-badge">' + target.score + '</div>';
                html += '</div>';
                
                html += '<div class="target-metrics">';
                html += '<div class="metric-small"><div class="metric-small-label">Revenue</div><div class="metric-small-value">' + formatCurrency(target.revenue) + '</div></div>';
                html += '<div class="metric-small"><div class="metric-small-label">Customers</div><div class="metric-small-value">' + target.customers + '</div></div>';
                html += '<div class="metric-small"><div class="metric-small-label">Valuation</div><div class="metric-small-value">' + formatCurrency(target.valuation) + '</div></div>';
                html += '</div>';
                
                html += '<div class="target-tags">';
                html += '<span class="tag tag-' + target.strategy + '">' + target.strategy.toUpperCase() + '</span>';
                html += '<span class="tag tag-' + target.positioning.toLowerCase() + '">' + target.positioning + '</span>';
                html += '</div>';
                
                html += '</div>';
            });
            
            document.getElementById('targetList').innerHTML = html;
            updateStats();
        }

        function updateStats() {
            document.getElementById('totalTargets').textContent = filteredTargets.length;
            var avgScore = Math.round(filteredTargets.reduce((sum, t) => sum + t.score, 0) / filteredTargets.length);
            document.getElementById('avgScore').textContent = avgScore;
            var totalVal = filteredTargets.reduce((sum, t) => sum + t.valuation, 0);
            document.getElementById('totalVal').textContent = formatCurrency(totalVal);
            var priority = filteredTargets.filter(t => t.tier === 'A').length;
            document.getElementById('priorityDeals').textContent = priority;
        }

        function focusTarget(id) {
            var target = targets.find(t => t.id === id);
            map.setView(target.coords, 10);
            markers.find(m => m.getLatLng().lat === target.coords[0] && m.getLatLng().lng === target.coords[1]).openPopup();
        }

        function applyFilters() {
            var strategy = document.getElementById('strategyFilter').value;
            var revenue = document.getElementById('revenueFilter').value;
            var minScore = parseInt(document.getElementById('scoreFilter').value);
            var market = document.getElementById('marketFilter').value;

            filteredTargets = targets.filter(function(t) {
                if (strategy !== 'all' && t.strategy !== strategy) return false;
                if (minScore && t.score < minScore) return false;
                if (market !== 'all' && t.market !== market) return false;
                
                if (revenue === 'sweet' && (t.revenue < 500000 || t.revenue > 3000000)) return false;
                if (revenue === 'small' && (t.revenue < 300000 || t.revenue >= 500000)) return false;
                if (revenue === 'large' && t.revenue < 3000000) return false;
                
                return true;
            });

            renderMap();
            renderTargetList();
        }

        // Event listeners
        document.getElementById('strategyFilter').addEventListener('change', applyFilters);
        document.getElementById('revenueFilter').addEventListener('change', applyFilters);
        document.getElementById('scoreFilter').addEventListener('input', function() {
            document.getElementById('scoreValue').textContent = this.value;
            applyFilters();
        });
        document.getElementById('marketFilter').addEventListener('change', applyFilters);

        // Initial render
        renderMap();
        renderTargetList();

        // Add Nutre presence for context (your existing markets)
        var nutrePresence = [
            {name: 'MD', coords: [39.0458, -76.6413], revenue: 85621},
            {name: 'VA', coords: [37.5407, -77.4360], revenue: 190413},
            {name: 'DC', coords: [38.9072, -77.0369], revenue: 27251},
            {name: 'FL', coords: [27.9944, -81.7603], revenue: 489126},
            {name: 'GA', coords: [33.7490, -84.3880], revenue: 117644}
        ];

        nutrePresence.forEach(function(loc) {
            L.circleMarker(loc.coords, {
                radius: 6,
                fillColor: '#7c3aed',
                color: '#fff',
                weight: 2,
                opacity: 0.6,
                fillOpacity: 0.3,
                dashArray: '5, 5'
            }).addTo(map).bindPopup('<strong>Nutre Current Presence</strong><br>' + loc.name + '<br>Revenue: ' + formatCurrency(loc.revenue));
        });
        
        // PIPELINE TRACKER FUNCTIONALITY
        
        var pipeline = JSON.parse(localStorage.getItem('nutrePipeline') || '{}');
        var currentDealId = null;
        
        function addToPipeline(targetId) {
            var target = targets.find(t => t.id === targetId);
            if (!target) return;
            
            if (pipeline[targetId]) {
                alert(target.name + ' is already in your pipeline!');
                openPipeline();
                return;
            }
            
            pipeline[targetId] = {
                id: targetId,
                stage: 'outreach',
                addedDate: new Date().toISOString(),
                contactDate: null,
                followUpDate: null,
                notes: ''
            };
            
            savePipeline();
            alert('‚úÖ Added ' + target.name + ' to pipeline!');
            updatePipelineBadge();
        }
        
        function savePipeline() {
            localStorage.setItem('nutrePipeline', JSON.stringify(pipeline));
        }
        
        function updatePipelineBadge() {
            var count = Object.keys(pipeline).length;
            document.getElementById('pipelineBadge').textContent = count;
        }
        
        function openPipeline() {
            document.getElementById('pipelineModal').classList.add('active');
            renderPipeline();
        }
        
        function closePipeline() {
            document.getElementById('pipelineModal').classList.remove('active');
        }
        
        function renderPipeline() {
            var stages = ['outreach', 'conversation', 'loi', 'diligence', 'closed'];
            var totalValue = 0;
            var activeCount = 0;
            
            stages.forEach(function(stage) {
                var stageEl = document.getElementById('stage-' + stage);
                stageEl.innerHTML = '';
                var count = 0;
                
                Object.keys(pipeline).forEach(function(targetId) {
                    var deal = pipeline[targetId];
                    if (deal.stage === stage) {
                        var target = targets.find(t => t.id == targetId);
                        if (!target) return;
                        
                        count++;
                        if (stage !== 'closed') {
                            totalValue += target.valuation;
                            activeCount++;
                        }
                        
                        var card = document.createElement('div');
                        card.className = 'deal-card tier-' + target.tier.toLowerCase();
                        card.onclick = function() { openDealDetail(targetId); };
                        
                        var html = '<div class="deal-card-header">' + target.name + '</div>';
                        html += '<div class="deal-card-meta">' + formatCurrency(target.valuation) + ' ‚Ä¢ Score: ' + target.score + '</div>';
                        html += '<div class="deal-card-tags">';
                        html += '<span class="deal-tag">' + target.location + '</span>';
                        html += '<span class="deal-tag">' + target.strategy.toUpperCase() + '</span>';
                        html += '</div>';
                        
                        if (deal.followUpDate) {
                            var followUpDate = new Date(deal.followUpDate);
                            var today = new Date();
                            var isOverdue = followUpDate < today;
                            html += '<div style="font-size: 10px; color: ' + (isOverdue ? '#ef4444' : '#10b981') + '; margin-top: 6px;">';
                            html += (isOverdue ? '‚ö†Ô∏è Follow-up overdue: ' : 'üìÖ Next follow-up: ') + followUpDate.toLocaleDateString();
                            html += '</div>';
                        }
                        
                        if (deal.notes) {
                            html += '<div class="deal-card-notes">' + deal.notes.substring(0, 60) + (deal.notes.length > 60 ? '...' : '') + '</div>';
                        }
                        
                        card.innerHTML = html;
                        stageEl.appendChild(card);
                    }
                });
                
                document.getElementById('count-' + stage).textContent = count;
            });
            
            document.getElementById('activeDealsCount').textContent = activeCount;
            document.getElementById('totalPipelineValue').textContent = formatCurrency(totalValue);
        }
        
        function openDealDetail(targetId) {
            currentDealId = targetId;
            var target = targets.find(t => t.id == targetId);
            var deal = pipeline[targetId];
            
            document.getElementById('dealDetailName').textContent = target.name;
            document.getElementById('dealStage').value = deal.stage;
            document.getElementById('dealContactDate').value = deal.contactDate || '';
            document.getElementById('dealFollowUpDate').value = deal.followUpDate || '';
            document.getElementById('dealNotes').value = deal.notes || '';
            
            document.getElementById('dealDetailModal').classList.add('active');
        }
        
        function closeDealDetail() {
            document.getElementById('dealDetailModal').classList.remove('active');
            currentDealId = null;
        }
        
        function saveDealDetails() {
            if (!currentDealId) return;
            
            pipeline[currentDealId].stage = document.getElementById('dealStage').value;
            pipeline[currentDealId].contactDate = document.getElementById('dealContactDate').value;
            pipeline[currentDealId].followUpDate = document.getElementById('dealFollowUpDate').value;
            pipeline[currentDealId].notes = document.getElementById('dealNotes').value;
            
            savePipeline();
            closeDealDetail();
            renderPipeline();
        }
        
        function removeDeal() {
            if (!currentDealId) return;
            
            var target = targets.find(t => t.id == currentDealId);
            if (confirm('Remove ' + target.name + ' from pipeline?')) {
                delete pipeline[currentDealId];
                savePipeline();
                closeDealDetail();
                renderPipeline();
                updatePipelineBadge();
            }
        }
        
        // Close modals on background click
        document.getElementById('pipelineModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closePipeline();
            }
        });
        
        document.getElementById('dealDetailModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeDealDetail();
            }
        });
        
        // Initialize pipeline badge
        updatePipelineBadge();
    </script>
</body>
</html>
